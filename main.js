!function(){"use strict";const e=document.querySelector(".profile__info"),t=(e.querySelector(".profile__header"),e.querySelector(".profile__profession"),document.querySelectorAll(".popup"),document.forms.profileForm,document.querySelector(".popup_type_profile")),s=document.querySelector(".profile__button"),r=(t.querySelector(".popup__close"),t.querySelector(".popup__input_type_name")),o=t.querySelector(".popup__input_type_profession"),i=document.querySelector(".popup_type-preview"),n=(document.querySelector(".popup_type_add-card"),document.querySelector(".add-button")),l=(document.querySelector(".popup__close.popup__close_preview"),document.querySelector(".popup__close.popup__close_add"),document.querySelector(".popup__input_type_title"),document.querySelector(".popup__input_type_link"),i.querySelector(".popup__image"),i.querySelector(".popup__subtitle"),document.querySelector(".elements__cards"),{inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",inputErrorClass:"popup__input-error_open",errorClass:"popup__error_visible"}),a=document.querySelector(".popup__form_edit"),c=document.querySelector(".popup__form_cards");function u(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var _=class{constructor(e,t){u(this,"_showInputError",((e,t)=>{const{inputErrorClass:s,errorClass:r}=this._settings,o=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(r),o.textContent=t,o.classList.add(s)})),u(this,"_hideInputError",(e=>{const{inputErrorClass:t,errorClass:s}=this._settings,r=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(s),r.classList.remove(t),r.textContent=""})),u(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),u(this,"_setEventListeners",(()=>{const{inputSelector:e}=this._settings;this.inputList=Array.from(this._formElement.querySelectorAll(e)),this._toggleButton(),this.inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButton()}))}))})),u(this,"_hasValidInput",(()=>this.inputList.every((e=>e.validity.valid)))),u(this,"_toggleButton",(()=>{const{inactiveButtonClass:e}=this._settings;this._inactiveButtonClass=e,this._hasValidInput()?this.enableButton():this.disableButton()})),u(this,"enableButton",(()=>{this._submitButton.disabled=!1,this._submitButton.classList.remove(this._inactiveButtonClass)})),u(this,"disableButton",(()=>{this._submitButton.disabled=!0,this._submitButton.classList.add(this._inactiveButtonClass)})),this._settings=e,this._formElement=t,this._submitButton=this._formElement.querySelector(this._settings.submitButtonSelector)}resetValidation(){this.inputList.forEach((e=>{this._hideInputError(e)}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}};function p(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class d{constructor(e,t,s,r,o){p(this,"_handleCardDelete",(()=>{this._cardElement.remove()})),p(this,"_addEventListeners",(()=>{this._likeButton.addEventListener("click",(()=>this._handleLikeIcon())),this._deleteButton.addEventListener("click",(()=>this._handleCardDelete())),this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._name,this._link)))})),this._data=e,this._name=e.name,this._link=e.link,this._likes=e.likes,this._id=e._id,this.userId=t,this._templateCardSelector=s,this._handleCardClick=r,this._handleLikeIcon=o}getId(){return this._id}_getTemplate(){return document.querySelector(this._templateCardSelector).content.querySelector(".elements__card")}setLikeCounter(e){this._likes=e;const t=this._likes.length;this._cardElement.querySelector(".elements__card_likes").textContent=t}generateCard(){return this._cardElement=this._getTemplate().cloneNode(!0),this._cardImage=this._cardElement.querySelector(".elements__image"),this._cardName=this._cardElement.querySelector(".elements__card-text"),this._likeButton=this._cardElement.querySelector(".elements__button-like"),this._deleteButton=this._cardElement.querySelector(".elements__button-delete"),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._cardName.textContent=this._name,this._addEventListeners(),this.setLikeCounter(this._likes),this._cardElement}}const h="popup_open";class m{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}open(){this._popup.classList.add(h),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove(h),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&this.close()}))}}class f extends m{constructor(e,t){super(e),this._handleSubmitForm=t,this._form=this._popup.querySelector(".popup__form"),this._inputs=this._form.querySelectorAll(".popup__input")}_getInputValues(){const e={};return this._inputs.forEach((t=>{const s=t.id,r=t.value;e[s]=r})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmitForm(this._getInputValues())}))}setInputValues(e){this._inputs.forEach((t=>{t.value=e[t.name]}))}close(){super.close(),this._form.reset()}}const y=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}getUserInfo(){return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}getInitialCards(){return fetch(this._baseUrl+"/cards",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}editProfile(e,t){return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}addCard(e,t){return fetch(this._baseUrl+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}addLike(e){return fetch(this._baseUrl+"/cards/likes/"+e,{method:"PUT",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(e.statusText)))}}({baseUrl:"https://around.nomoreparties.co/v1/cohort-3-en",headers:{authorization:"9398a483-484e-4ebd-a374-b6b3b985e9c4","Content-Type":"application/json"}});let b;y.getUserInfo().then((e=>{b=e.id,L.setUserInfo(e.name,e.about)})).catch(console.log),y.getInitialCards().then((e=>{console.log("res getInitialCards =>",e),C.rendererItems(e)})).catch(console.log);const S=new _(l,a),g=new _(l,c);S.enableValidation(),g.enableValidation(),S.resetValidation();const E=new f("#popup-template-form",(e=>{y.addCard(e.cardTitle,e.cardImageLink).then((e=>{console.log("res =>",e);const t={name:e.name,link:e.link};C.addItem(t)})).catch(console.log),E.close()}));E.setEventListeners();const v=new f("#popup-template",(e=>{y.editProfile(e.name,e.profession).then((t=>{L.setUserInfo(e.name,e.profession)})).catch(console.log).finally((()=>{v.close()}))}));v.setEventListeners();const k=new class extends m{constructor(e){super(e),this._subtitle=this._popup.querySelector(".popup__subtitle"),this._image=this._popup.querySelector(".popup__image")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._subtitle.textContent=e}}("#popup-image");k.setEventListeners();const C=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}rendererItems(e){e.forEach((e=>{this.addItem(e)}))}addItem(e){const t=this._renderer(e);this._container.prepend(t)}}({renderer:e=>{const t=new d(e,"...","#card-template",((e,t)=>{k.open(e,t)}),(()=>{y.addLike(t.getId()).then((e=>{t.setLikeCounter(e.likes),console.log("You like it don't you")}))}));return t.generateCard()}},".elements__cards"),L=new class{constructor(e){let{profileNameSelector:t,profileProfessionSelector:s}=e;this._profileName=document.querySelector(t),this._profileProfession=document.querySelector(s)}getUserInfo(){return{name:this._profileName.textContent,profession:this._profileProfession.textContent}}setUserInfo(e,t){this._profileName.textContent=e,this._profileProfession.textContent=t}}({profileNameSelector:".profile__header",profileProfessionSelector:".profile__profession"});s.addEventListener("click",(()=>{const e=L.getUserInfo();r.value=e.name,o.value=e.profession,S.resetValidation(),S.enableButton(),v.open()})),n.addEventListener("click",(()=>{g.resetValidation(),g.disableButton(),E.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUt4RixlQUFlNEMsRUFBSWxELE9BQ3hCcUUsUUFBUUMsSUFBSSwrQkFNbkIsT0FBT3dCLEVBQUtwRixpQkFPVCxvQkFJRXdELEVBQVcsSUdsSFYsTUFDTDFILFlBQVksR0FDWixJQURZLG9CQUFDdUosRUFBRCwwQkFBc0JDLEdBQ2xDLEVBQ0VwSixLQUFLcUosYUFBYzVLLFNBQVNDLGNBQWN5SyxHQUMxQ25KLEtBQUtzSixtQkFBcUI3SyxTQUFTQyxjQUFjMEssR0FHbkRqRCxjQUNFLE1BQU8sQ0FDTGxELEtBQU1qRCxLQUFLcUosYUFBYTlJLFlBQ3hCK0gsV0FBWXRJLEtBQUtzSixtQkFBbUIvSSxhQUl4Q2dILFlBQVl0RSxFQUFNcUYsR0FDaEJ0SSxLQUFLcUosYUFBYTlJLFlBQWMwQyxFQUNoQ2pELEtBQUtzSixtQkFBbUIvSSxZQUFjK0gsSUhrR1osQ0FDNUJhLG9CQUFxQixtQkFDckJDLDBCQUEyQix5QkFnQjdCckssRUFBV29DLGlCQUFpQixTQVpILEtBQ3ZCLE1BQU0zQyxFQUFjOEksRUFBU25CLGNBRTdCbkgsRUFBVXlHLE1BQVFqSCxFQUFZeUUsS0FDOUJoRSxFQUFnQndHLE1BQVFqSCxFQUFZOEosV0FFcENULEVBQWtCakcsa0JBQ2xCaUcsRUFBa0JyRyxlQUNsQjZHLEVBQWlCekQsVUFRbkJ6RixFQUFVZ0MsaUJBQWlCLFNBQVMsS0FDbEM0RyxFQUFxQm5HLGtCQUNyQm1HLEVBQXFCdEcsZ0JBQ3JCdUcsRUFBYXBELFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLnByb2plY3QvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0ucHJvamVjdC8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS5wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLnByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLnByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFjdGljdW0ucHJvamVjdC8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS5wcm9qZWN0Ly4vc3JjL3BhZ2UvaW5kZXguanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS5wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWN0aWN1bS5wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJhY3RpY3VtLnByb2plY3QvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvL0ZvciBQcm9maWxlIGFuZCBwb3B1cCBlbGVtZW50c1xuY29uc3QgcHJvZmlsZUluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2luZm9cIik7XG5jb25zdCBwcm9maWxlTmFtZSA9IHByb2ZpbGVJbmZvLnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faGVhZGVyXCIpO1xuY29uc3QgcHJvZmlsZVByb2Zlc3Npb24gPSBwcm9maWxlSW5mby5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3Byb2Zlc3Npb25cIik7XG5jb25zdCBwb3B1cExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwXCIpO1xuXG5jb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmZvcm1zLnByb2ZpbGVGb3JtOyAvL3F1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9mb3JtJyk7Ly9cbmNvbnN0IHByb2ZpbGVQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZV9wcm9maWxlXCIpOyAvLy5wb3B1cCBiYXN0YWtpIHNpbGluZGlcbmNvbnN0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2J1dHRvblwiKTtcbi8vY29uc3Qgc2F2ZUJ1dHRvbiA9IHByb2ZpbGVQb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX3NhdmUnKTsgIC8vbm90IHVzZWQtc3VibWl0QnV0dG9uU2VsZWN0b3IgdXNlZCBpbiBzZXR0aW5nc1xuY29uc3QgY2xvc2VCdXR0b24gPSBwcm9maWxlUG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2xvc2VcIik7XG5jb25zdCBpbnB1dE5hbWUgPSBwcm9maWxlUG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfdHlwZV9uYW1lXCIpO1xuY29uc3QgaW5wdXRQcm9mZXNzaW9uID0gcHJvZmlsZVBvcHVwLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnBvcHVwX19pbnB1dF90eXBlX3Byb2Zlc3Npb25cIlxuKTtcbmNvbnN0IHBvcHVwU2VsZWN0b3IgPSBcInBvcHVwX29wZW5cIjtcblxuLy8gLy8vLy9DQVJEU1xuY29uc3QgQ2FyZF9UZW1wbGF0ZV9TZWxlY3RvciA9IFwiI2NhcmQtdGVtcGxhdGVcIjtcbmNvbnN0IHByZXZpZXdJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfdHlwZS1wcmV2aWV3XCIpO1xuY29uc3QgY2FyZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX2FkZC1jYXJkXCIpO1xuY29uc3QgYWRkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hZGQtYnV0dG9uXCIpO1xuY29uc3QgcHJldmlld0J1dHRvbkNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucG9wdXBfX2Nsb3NlLnBvcHVwX19jbG9zZV9wcmV2aWV3XCJcbik7XG5jb25zdCBidXR0b25DbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlLnBvcHVwX19jbG9zZV9hZGRcIik7XG5jb25zdCBpbnB1dFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfdHlwZV90aXRsZVwiKTtcbmNvbnN0IGlucHV0SW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF90eXBlX2xpbmtcIik7XG5jb25zdCBwb3B1cEltYWdlID0gcHJldmlld0ltYWdlLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlXCIpO1xuY29uc3QgcG9wdXBUaXRsZSA9IHByZXZpZXdJbWFnZS5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19zdWJ0aXRsZVwiKTtcbi8vIFdyYXBwZXJzXG5jb25zdCBlbGVtZW50c0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRzX19jYXJkc1wiKTtcblxuY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX3NhdmVcIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fc2F2ZV9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwicG9wdXBfX2lucHV0LWVycm9yX29wZW5cIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3QgZWRpdEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtX2VkaXRcIik7XG5jb25zdCBhZGRDYXJkRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Zvcm1fY2FyZHNcIik7XG5cbmV4cG9ydCB7XG4gIHNldHRpbmdzLCBlZGl0Rm9ybSwgYWRkQ2FyZEZvcm0sIGVkaXRCdXR0b24sIGNsb3NlQnV0dG9uLCBpbnB1dE5hbWUsIGlucHV0UHJvZmVzc2lvbiwgYWRkQnV0dG9uLCBlbGVtZW50c0xpc3Rcbn07XG4iLCJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICAgICk7XG4gIH1cblxuICBfc2hvd0lucHV0RXJyb3IgPSAoaW5wdXQsIGVycm9yTWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvckNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcblxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0LmlkfS1lcnJvcmApO1xuICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoZXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGlucHV0RXJyb3JDbGFzcyk7XG4gIH07XG5cbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0KSA9PiB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXQuaWR9LWVycm9yYCk7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShlcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIH07XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eSA9IChpbnB1dCkgPT4ge1xuICAgIGlmICghaW5wdXQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0LCBpbnB1dC52YWxpZGF0aW9uTWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0KTtcbiAgICB9XG4gIH07XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgaW5wdXRTZWxlY3RvciB9ID0gdGhpcy5fc2V0dGluZ3M7XG5cbiAgICB0aGlzLmlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGlucHV0U2VsZWN0b3IpXG4gICAgKTtcblxuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvbigpOyAvL21ldGhvZCBjaGVja1xuXG4gICAgdGhpcy5pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvbigpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgX2hhc1ZhbGlkSW5wdXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRMaXN0LmV2ZXJ5KChpbnB1dCkgPT4gaW5wdXQudmFsaWRpdHkudmFsaWQpO1xuICB9O1xuXG4gIF90b2dnbGVCdXR0b24gPSAoKSA9PiB7XG4gICAgY29uc3QgeyBpbmFjdGl2ZUJ1dHRvbkNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gaW5hY3RpdmVCdXR0b25DbGFzcztcblxuICAgIGlmICh0aGlzLl9oYXNWYWxpZElucHV0KCkpIHtcbiAgICAgIHRoaXMuZW5hYmxlQnV0dG9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbigpO1xuICAgIH1cbiAgfTtcblxuICBlbmFibGVCdXR0b24gPSAoKSA9PiB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH07XG5cbiAgZGlzYWJsZUJ1dHRvbiA9ICgpID0+IHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9O1xuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLmlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXQpO1xuICAgIH0pO1xuICB9XG5cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yO1xuIiwiZXhwb3J0IGNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihkYXRhLCB1c2VySWQsIHRlbXBsYXRlQ2FyZFNlbGVjdG9yLCBoYW5kbGVDYXJkQ2xpY2ssIGhhbmRsZUxpa2VJY29uKSB7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICAgIHRoaXMudXNlcklkID0gdXNlcklkO1xuXG5cbiAgICB0aGlzLl90ZW1wbGF0ZUNhcmRTZWxlY3RvciA9IHRlbXBsYXRlQ2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUNhcmRDbGljayA9IGhhbmRsZUNhcmRDbGljaztcbiAgICB0aGlzLl9oYW5kbGVMaWtlSWNvbiA9IGhhbmRsZUxpa2VJY29uO1xuICB9XG5cbiAgZ2V0SWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lkXG4gIH1cblxuICBfZ2V0VGVtcGxhdGUoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5fdGVtcGxhdGVDYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudHNfX2NhcmQnKTtcbiAgfVxuXG4gIC8vIF9oYW5kbGVMaWtlSWNvbiA9ICgpID0+IHtcbiAgLy8gICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2VsZW1lbnRzX19idXR0b24tbGlrZV9hY3RpdmUnKTtcbiAgLy8gfVxuXG4gIF9oYW5kbGVDYXJkRGVsZXRlID0gKCkgPT4ge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9XG5cbiAgX2FkZEV2ZW50TGlzdGVuZXJzID0gKCkgPT4ge1xuICAgIHRoaXMuX2xpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLl9oYW5kbGVMaWtlSWNvbigpKTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB0aGlzLl9oYW5kbGVDYXJkRGVsZXRlKCkpO1xuICAgIHRoaXMuX2NhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuX2hhbmRsZUNhcmRDbGljayh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKSk7XG4gIH1cblxuICBzZXRMaWtlQ291bnRlcihuZXdMaWtlcykgeyAgIC8vbGVuZ3RoIGvEsXNtxLFuxLEgb2t1eWFtxLF5b3Iga2FydCBla2xlbmVtaXlvclxuICAgIHRoaXMuX2xpa2VzID0gbmV3TGlrZXNcbiAgICBjb25zdCBsaWtlQ291bnRlciA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudHNfX2NhcmRfbGlrZXMnKS50ZXh0Q29udGVudCA9IGxpa2VDb3VudGVyO1xuXG4gICAgY29uc3QgbGlrZUNsaWNrZWRieUN1cnJlbnRVc2VyID0gZmFsc2U7XG4gICAgaWYobGlrZUNsaWNrZWRieUN1cnJlbnRVc2VyKSB7XG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2VsZW1lbnRzX19idXR0b24tbGlrZV9hY3RpdmUnKTtcbiAgICB9XG5cblxuICB9XG5cbiAgZ2VuZXJhdGVDYXJkKCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICB0aGlzLl9jYXJkSW1hZ2UgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudHNfX2ltYWdlJyk7XG4gICAgdGhpcy5fY2FyZE5hbWUgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudHNfX2NhcmQtdGV4dCcpO1xuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuZWxlbWVudHNfX2J1dHRvbi1saWtlJyk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmVsZW1lbnRzX19idXR0b24tZGVsZXRlJyk7XG5cbiAgICAvL2NhcmQgLy8gZGVzdHJ1Y3R1cmluZyBhc3NpZ25tZW50Ly9cbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG5cbiAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuc2V0TGlrZUNvdW50ZXIodGhpcy5fbGlrZXMpO1xuXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50O1xuICB9XG59XG5cbiIsImNvbnN0IFBPUFVQX0NMQVNTID0gJ3BvcHVwJztcbmNvbnN0IENMT1NFX0JVVFRPTl9DTEFTUyA9ICdwb3B1cF9fY2xvc2UnO1xuY29uc3QgUE9QVVBfU0VMRUNUT1JfQ0xBU1MgPSAncG9wdXBfb3Blbic7XG5cbmV4cG9ydCBjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3RvcilcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcylcbiAgfVxuXG4gIF9oYW5kbGVFc2NDbG9zZShldnQpIHtcbiAgICBpZiAoZXZ0LmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fcG9wdXAuY2xhc3NMaXN0LmFkZChQT1BVUF9TRUxFQ1RPUl9DTEFTUyk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoUE9QVVBfU0VMRUNUT1JfQ0xBU1MpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoUE9QVVBfQ0xBU1MpIHx8XG4gICAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKENMT1NFX0JVVFRPTl9DTEFTUylcbiAgICAgICkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxufVxuLy8qKiogbW91c2Vkb3duIHJlcGxhY2VkIGNsaWNrIHRvIHByZXZlbnQgdGhlIGJ1ZyBpZiB5b3UgY2xpY2sgaW5zaWRlIGEgcG9wdXAgYW5kIHRoZW4gbW92ZSB5b3VyIG1vdXNlIG91dHNpZGUgaXRcbi8vIGFuZCByZWxlYXNlIHRoZSBidXR0b24gYWJvdmUgdGhlIG92ZXJsYXkgdGhlbiB0aGUgcG9wdXAgY2xvc2VzIGJ1dCBpdOKAmXMgbm90XG4iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yLCBoYW5kbGVTdWJtaXRGb3JtICkge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpXG5cbiAgICB0aGlzLl9oYW5kbGVTdWJtaXRGb3JtID0gaGFuZGxlU3VibWl0Rm9ybVxuICAgIHRoaXMuX2Zvcm0gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0nKVxuICAgIHRoaXMuX2lucHV0cyA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19pbnB1dCcpICAgICAgIC8vWy4uLnRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19pbnB1dCcpXVxuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIGNvbnN0IHZhbHVlcyA9IHt9XG5cblxuICAgIHRoaXMuX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gaW5wdXQuaWRcbiAgICAgIGNvbnN0IHZhbHVlID0gaW5wdXQudmFsdWVcbiAgICAgIHZhbHVlc1trZXldID0gdmFsdWVcbiAgICB9KVxuICAgIHJldHVybiB2YWx1ZXM7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKClcblxuICAgICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKCAnc3VibWl0JywgKGUpID0+IHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgICAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdEZvcm0odGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSlcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICBzZXRJbnB1dFZhbHVlcyhkYXRhKXtcbiAgICB0aGlzLl9pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LnZhbHVlID0gZGF0YVtpbnB1dC5uYW1lXTtcbiAgICB9KVxuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgICBzdXBlci5jbG9zZSgpXG4gICAgICB0aGlzLl9mb3JtLnJlc2V0KClcbiAgfVxuXG59XG5cbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gb3B0aW9ucy5iYXNlVXJsXG4gICAgdGhpcy5faGVhZGVycyA9IG9wdGlvbnMuaGVhZGVyc1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL3VzZXJzL21lJywge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgIH0pLnRoZW4oIHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxuICAgIC8vIC5jYXRjaChlcnIgPT4ge1xuICAgIC8vICAgY29uc29sZS5sb2coJ0FwaSBoYXMgYW4gZXJyb3IhISEnKVxuICAgIC8vIH0pXG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL2NhcmRzJywge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xuICAgIH0pLnRoZW4oIHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxuICB9IC8vbmFtZSAgJiBsaW5rIGluIHRoZSBib2R5P1xuXG4gIGVkaXRQcm9maWxlKG5hbWUsIGFib3V0KSB7XG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyAnL3VzZXJzL21lJywge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pXG4gICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSlcbiAgfVxuXG4gIGFkZENhcmQobmFtZSwgbGluaykge1xuICAgIHJldHVybiBmZXRjaCh0aGlzLl9iYXNlVXJsICsgJy9jYXJkcycsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSlcbiAgICB9KS50aGVuKHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxuICB9XG5cbiAgYWRkTGlrZShpZCkge1xuICAgIHJldHVybiBmZXRjaCh0aGlzLl9iYXNlVXJsICsgJy9jYXJkcy9saWtlcy8nICsgaWQsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbihyZXMgPT4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KHJlcy5zdGF0dXNUZXh0KSlcbiAgfVxuXG59XG5cbmV4cG9ydCBjb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2NvaG9ydC0zLWVuXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjkzOThhNDgzLTQ4NGUtNGViZC1hMzc0LWI2YjNiOTg1ZTljNFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gIH1cbn0pOyAvLyB0aGlzLl9iYXNlVXJsIC8vIHRoaXMuX2hlYWRlcnNcbiIsIlxuaW1wb3J0IFwiLi4vcGFnZS9pbmRleC5jc3NcIjsgLy8gbWFpbiBicmlkZ2UgdG8gY3NzIGZpbGVzIGFmdGVyIHdlYnBhY2sgYnVpbGQgYWx3YXlzIGluc3RhbGwgMXN0XG5cbmltcG9ydCB7IHNldHRpbmdzLCBlZGl0Rm9ybSwgYWRkQ2FyZEZvcm0sIGVkaXRCdXR0b24sIGNsb3NlQnV0dG9uLCBpbnB1dE5hbWUsIGlucHV0UHJvZmVzc2lvbixcbiAgYWRkQnV0dG9uLCBlbGVtZW50c0xpc3QgfSBmcm9tICcuLi91dGlscy9jb25zdGFudHMuanMnO1xuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSAnLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzJztcbmltcG9ydCB7IENhcmQgfSBmcm9tICcuLi9jb21wb25lbnRzL0NhcmQuanMnO1xuaW1wb3J0IHsgU2VjdGlvbiB9IGZyb20gJy4uL2NvbXBvbmVudHMvU2VjdGlvbi5qcyc7XG5pbXBvcnQgeyBQb3B1cFdpdGhGb3JtIH0gZnJvbSAnLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzJztcbmltcG9ydCB7IFBvcHVwV2l0aEltYWdlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCB7IFVzZXJJbmZvIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcblxuaW1wb3J0IHsgYXBpLCBBcGkgfSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5cbmxldCB1c2VySWRcblxuYXBpLmdldFVzZXJJbmZvKClcbiAgLnRoZW4oIHJlcyA9PiB7XG4gICAgdXNlcklkID0gcmVzLmlkXG4gICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzLm5hbWUsICByZXMuYWJvdXQpXG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmxvZylcblxuYXBpLmdldEluaXRpYWxDYXJkcygpXG4gIC50aGVuKCByZXMgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdyZXMgZ2V0SW5pdGlhbENhcmRzID0+JywgcmVzKVxuXG4gICAgc2VjdGlvbi5yZW5kZXJlckl0ZW1zKHJlcyk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmxvZylcblxuXG5cblxuLy9mb3JtIHZhbGlkYXRvciBzZXR0aW5ncyBkb20gcmVmZXJlbmNlcy8vXG5jb25zdCBlZGl0Rm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBzZXR0aW5ncyxcbiAgIGVkaXRGb3JtXG4gICk7XG5jb25zdCBhZGRDYXJkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKFxuICBzZXR0aW5ncyxcbiAgYWRkQ2FyZEZvcm1cbiAgKTtcblxuZWRpdEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuYWRkQ2FyZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuZWRpdEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG5cbi8vYWRkY2FyZHN1Ym1pdFxuY29uc3QgaGFuZGxlQ2FyZFN1Ym1pdCA9IChkYXRhKSA9PiB7XG5cbiAgYXBpLmFkZENhcmQoZGF0YS5jYXJkVGl0bGUsIGRhdGEuY2FyZEltYWdlTGluaylcbiAgLnRoZW4ocmVzID0+IHtcbiAgICBjb25zb2xlLmxvZygncmVzID0+JywgcmVzKVxuICAgIGNvbnN0IGNhcmQgPSB7XG4gICAgICBuYW1lOiByZXMubmFtZSxcbiAgICAgIGxpbms6IHJlcy5saW5rLFxuICAgIH07XG4gICAgc2VjdGlvbi5hZGRJdGVtKGNhcmQpO1xuICB9KVxuICAuY2F0Y2goY29uc29sZS5sb2cpXG5cbiAgYWRkQ2FyZFBvcHVwLmNsb3NlKCk7XG59XG4vL2VkaXRwcm9maWxlIHN1Ym1pdFxuY29uc3QgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQgPSAoZGF0YSkgPT4ge1xuICBhcGkuZWRpdFByb2ZpbGUoZGF0YS5uYW1lLCBkYXRhLnByb2Zlc3Npb24pXG4gIC50aGVuKCByZXMgPT4ge1xuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKGRhdGEubmFtZSwgZGF0YS5wcm9mZXNzaW9uKVxuICB9KVxuICAuY2F0Y2goY29uc29sZS5sb2cpXG4gIC5maW5hbGx5KCAoKSA9PiB7XG4gICAgZWRpdFByb2ZpbGVQb3B1cC5jbG9zZSgpXG4gIH0pXG59O1xuXG5jb25zdCBhZGRDYXJkUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSgnI3BvcHVwLXRlbXBsYXRlLWZvcm0nLCBoYW5kbGVDYXJkU3VibWl0KVxuYWRkQ2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCkgLy9vbmx5IGNhbGwgb25jZSAsIG5ldmVyIGluIGlmIGxvb3AgZXRjXG5cbmNvbnN0IGVkaXRQcm9maWxlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSgnI3BvcHVwLXRlbXBsYXRlJywgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpXG5lZGl0UHJvZmlsZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKClcblxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZSgnI3BvcHVwLWltYWdlJylcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgY3JlYXRlQ2FyZCA9IChkYXRhKSA9PiB7XG4gIGNvbnN0IGl0ZW0gPSBuZXcgQ2FyZCAoXG4gICAgZGF0YSxcbiAgICAnLi4uJyxcbiAgICAnI2NhcmQtdGVtcGxhdGUnLFxuICAobmFtZSwgbGluaykgPT4ge1xuICAgIGltYWdlUG9wdXAub3BlbihuYW1lLCBsaW5rKVxuICAgIH0sXG4gICAgKCkgPT4ge1xuICAgICAgYXBpLmFkZExpa2UoaXRlbS5nZXRJZCgpKVxuICAgICAgLnRoZW4ocmVzID0+IHtcbiAgICAgICAgaXRlbS5zZXRMaWtlQ291bnRlcihyZXMubGlrZXMpLFxuICAgICAgICBjb25zb2xlLmxvZygnWW91IGxpa2UgaXQgZG9uXFwndCB5b3UnKVxuICAgICAgICAvL1xuICAgICAgfSlcbiAgICB9XG4gICk7XG5cbiByZXR1cm4gaXRlbS5nZW5lcmF0ZUNhcmQoKTtcbn1cblxuY29uc3Qgc2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxuICAgIHtcbiAgICAgIHJlbmRlcmVyOiBjcmVhdGVDYXJkLFxuICAgIH0sXG4gICAgJy5lbGVtZW50c19fY2FyZHMnXG4gIClcblxuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIHByb2ZpbGVOYW1lU2VsZWN0b3I6ICcucHJvZmlsZV9faGVhZGVyJyxcbiAgcHJvZmlsZVByb2Zlc3Npb25TZWxlY3RvcjogJy5wcm9maWxlX19wcm9mZXNzaW9uJyxcbn0pXG5cbi8vdXNlcmluZm8gY2xhc3NcbmNvbnN0IG9wZW5Qcm9maWxlUG9wdXAgPSAoKSA9PiB7XG4gIGNvbnN0IHByb2ZpbGVJbmZvID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcblxuICBpbnB1dE5hbWUudmFsdWUgPSBwcm9maWxlSW5mby5uYW1lXG4gIGlucHV0UHJvZmVzc2lvbi52YWx1ZSA9IHByb2ZpbGVJbmZvLnByb2Zlc3Npb247XG5cbiAgZWRpdEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7IC8vMiBrZXJlIG1pIHJlc2V0bGVuZGkgYmFrYWzEsW1cbiAgZWRpdEZvcm1WYWxpZGF0b3IuZW5hYmxlQnV0dG9uKCk7XG4gIGVkaXRQcm9maWxlUG9wdXAub3BlbigpXG59XG5cbi8vRXZlbnQgaGFuZGxlcnNcbmVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcGVuUHJvZmlsZVBvcHVwKTtcblxuXG5cbmFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhZGRDYXJkRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbiAgYWRkQ2FyZEZvcm1WYWxpZGF0b3IuZGlzYWJsZUJ1dHRvbigpO1xuICBhZGRDYXJkUG9wdXAub3BlbigpO1xufSlcblxuXG5cbiIsIlxuaW1wb3J0IHsgUG9wdXAgfSBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5leHBvcnQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKVxuICAgIHRoaXMuX3N1YnRpdGxlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19zdWJ0aXRsZScpO1xuICAgIHRoaXMuX2ltYWdlID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpO1xuICB9XG5cblxuICBvcGVuKG5hbWUsIGxpbmspIHtcblxuICAgIHN1cGVyLm9wZW4oKVxuICAgICAgdGhpcy5faW1hZ2Uuc3JjID0gbGluaztcbiAgICAgIHRoaXMuX2ltYWdlLmFsdCA9IG5hbWU7XG4gICAgICB0aGlzLl9zdWJ0aXRsZS50ZXh0Q29udGVudCA9IG5hbWU7XG5cbiAgfVxuXG59XG4iLCJcbmV4cG9ydCBjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyByZW5kZXJlciB9LCBjb250YWluZXIgKSB7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lcik7XG4gIH1cblxuXG5cbiAgcmVuZGVyZXJJdGVtcyhpdGVtcykge1xuICAgIGl0ZW1zLmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgICAgdGhpcy5hZGRJdGVtKGRhdGEpXG4gICAgfSlcbiAgfTtcblxuICBhZGRJdGVtKGRhdGEpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5fcmVuZGVyZXIoZGF0YSlcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KVxuICB9O1xuXG5cbn1cbiIsImV4cG9ydCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKHtwcm9maWxlTmFtZVNlbGVjdG9yLCBwcm9maWxlUHJvZmVzc2lvblNlbGVjdG9yfSlcbiAge1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVOYW1lU2VsZWN0b3IpXG4gICAgdGhpcy5fcHJvZmlsZVByb2Zlc3Npb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHByb2ZpbGVQcm9mZXNzaW9uU2VsZWN0b3IpXG4gIH1cblxuICBnZXRVc2VySW5mbygpe1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl9wcm9maWxlTmFtZS50ZXh0Q29udGVudCxcbiAgICAgIHByb2Zlc3Npb246IHRoaXMuX3Byb2ZpbGVQcm9mZXNzaW9uLnRleHRDb250ZW50LFxuICAgIH1cbiAgfVxuXG4gIHNldFVzZXJJbmZvKG5hbWUsIHByb2Zlc3Npb24pIHtcbiAgICB0aGlzLl9wcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5fcHJvZmlsZVByb2Zlc3Npb24udGV4dENvbnRlbnQgPSBwcm9mZXNzaW9uO1xuICB9XG5cblxufVxuIl0sIm5hbWVzIjpbInByb2ZpbGVJbmZvIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicHJvZmlsZVBvcHVwIiwicXVlcnlTZWxlY3RvckFsbCIsImZvcm1zIiwicHJvZmlsZUZvcm0iLCJlZGl0QnV0dG9uIiwiaW5wdXROYW1lIiwiaW5wdXRQcm9mZXNzaW9uIiwicHJldmlld0ltYWdlIiwiYWRkQnV0dG9uIiwic2V0dGluZ3MiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImVkaXRGb3JtIiwiYWRkQ2FyZEZvcm0iLCJjb25zdHJ1Y3RvciIsImZvcm1FbGVtZW50IiwiaW5wdXQiLCJlcnJvck1lc3NhZ2UiLCJ0aGlzIiwiX3NldHRpbmdzIiwiZXJyb3JFbGVtZW50IiwiX2Zvcm1FbGVtZW50IiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInJlbW92ZSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImlucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsIl90b2dnbGVCdXR0b24iLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJldmVyeSIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2hhc1ZhbGlkSW5wdXQiLCJlbmFibGVCdXR0b24iLCJkaXNhYmxlQnV0dG9uIiwiX3N1Ym1pdEJ1dHRvbiIsImRpc2FibGVkIiwicmVzZXRWYWxpZGF0aW9uIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2dCIsInByZXZlbnREZWZhdWx0IiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiQ2FyZCIsImRhdGEiLCJ1c2VySWQiLCJ0ZW1wbGF0ZUNhcmRTZWxlY3RvciIsImhhbmRsZUNhcmRDbGljayIsImhhbmRsZUxpa2VJY29uIiwiX2NhcmRFbGVtZW50IiwiX2xpa2VCdXR0b24iLCJfaGFuZGxlTGlrZUljb24iLCJfZGVsZXRlQnV0dG9uIiwiX2hhbmRsZUNhcmREZWxldGUiLCJfY2FyZEltYWdlIiwiX2hhbmRsZUNhcmRDbGljayIsIl9uYW1lIiwiX2xpbmsiLCJfZGF0YSIsIm5hbWUiLCJsaW5rIiwiX2xpa2VzIiwibGlrZXMiLCJfaWQiLCJfdGVtcGxhdGVDYXJkU2VsZWN0b3IiLCJnZXRJZCIsIl9nZXRUZW1wbGF0ZSIsImNvbnRlbnQiLCJzZXRMaWtlQ291bnRlciIsIm5ld0xpa2VzIiwibGlrZUNvdW50ZXIiLCJsZW5ndGgiLCJnZW5lcmF0ZUNhcmQiLCJjbG9uZU5vZGUiLCJfY2FyZE5hbWUiLCJzcmMiLCJhbHQiLCJfYWRkRXZlbnRMaXN0ZW5lcnMiLCJQT1BVUF9TRUxFQ1RPUl9DTEFTUyIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cCIsIl9oYW5kbGVFc2NDbG9zZSIsImJpbmQiLCJrZXkiLCJjbG9zZSIsIm9wZW4iLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJjb250YWlucyIsIlBvcHVwV2l0aEZvcm0iLCJoYW5kbGVTdWJtaXRGb3JtIiwic3VwZXIiLCJfaGFuZGxlU3VibWl0Rm9ybSIsIl9mb3JtIiwiX2lucHV0cyIsIl9nZXRJbnB1dFZhbHVlcyIsInZhbHVlcyIsInZhbHVlIiwiZSIsInNldElucHV0VmFsdWVzIiwicmVzZXQiLCJhcGkiLCJvcHRpb25zIiwiX2Jhc2VVcmwiLCJiYXNlVXJsIiwiX2hlYWRlcnMiLCJoZWFkZXJzIiwiZ2V0VXNlckluZm8iLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzVGV4dCIsImdldEluaXRpYWxDYXJkcyIsImVkaXRQcm9maWxlIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJhZGRMaWtlIiwiYXV0aG9yaXphdGlvbiIsInVzZXJJbmZvIiwic2V0VXNlckluZm8iLCJjYXRjaCIsImNvbnNvbGUiLCJsb2ciLCJzZWN0aW9uIiwicmVuZGVyZXJJdGVtcyIsImVkaXRGb3JtVmFsaWRhdG9yIiwiRm9ybVZhbGlkYXRvciIsImFkZENhcmRGb3JtVmFsaWRhdG9yIiwiYWRkQ2FyZFBvcHVwIiwiY2FyZFRpdGxlIiwiY2FyZEltYWdlTGluayIsImNhcmQiLCJhZGRJdGVtIiwiZWRpdFByb2ZpbGVQb3B1cCIsInByb2Zlc3Npb24iLCJmaW5hbGx5IiwiaW1hZ2VQb3B1cCIsIl9zdWJ0aXRsZSIsIl9pbWFnZSIsImNvbnRhaW5lciIsInJlbmRlcmVyIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIml0ZW1zIiwiZWxlbWVudCIsInByZXBlbmQiLCJpdGVtIiwicHJvZmlsZU5hbWVTZWxlY3RvciIsInByb2ZpbGVQcm9mZXNzaW9uU2VsZWN0b3IiLCJfcHJvZmlsZU5hbWUiLCJfcHJvZmlsZVByb2Zlc3Npb24iXSwic291cmNlUm9vdCI6IiJ9